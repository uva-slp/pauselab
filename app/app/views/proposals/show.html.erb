
<!-- <%= link_to 'Back', proposals_path %>
<% if can? :edit, @proposal %>
| <%= link_to 'Edit', edit_proposal_path(@proposal) %>
<% end %> -->

<style media="screen">
  .proposal-cost:hover {
    cursor: pointer ;
  }
</style>

<h1 class="text-sm-right">
  <%= @proposal.title %>
</h1>

<h3 class="text-sm-right">
  <% if @proposal.website_link.blank? %>
    <%= @proposal.user.fullname %>
  <% else %>
    <%= link_to @proposal.user.fullname, @proposal.website_link %>
  <% end %>
  <small class="text-muted"> â€¢ <%= @proposal.created_at.strftime("%b %e") %></small>
</h3>

<h5 class="text-muted text-sm-right proposal-cost" data-toggle="modal" data-target="#budget_display">
  <span title="view breakdown" data-toggle="tooltip">
    <i class="fa fa-dollar"></i> <%= number_to_currency @proposal.proposal_budget.cost, :unit => "" %>
  </span>
</h5>

<%# TODO: limit scope %>
<% if @proposal.approved? %>
  <h5 class="text-sm-right"><span class="badge badge-success">approved</span></h5>
<% else %>
  <h5 class="text-sm-right"><span class="badge badge-danger">unchecked</span></h5>
<% end %>

<span class="proposal-tools">

  <% if can? :approve, @proposal %>
    <% if @proposal.unchecked? %>
      <%= link_to proposal_approve_path(@proposal), method: :post, title: "approve", class: "btn btn-sm btn-primary", data: { confirm: 'Are you sure?', toggle: "tooltip" } do %>
        <i class="fa fa-check"></i>
      <% end %>
    <% else %>
      <%= link_to proposal_approve_path(@proposal), method: :post, title: "disapprove", class: "btn btn-sm btn-primary", data: { confirm: 'Are you sure?', toggle: "tooltip" } do %>
        <i class="fa fa-times"></i>
      <% end %>
    <% end %>
  <% end %>

  <% if can? :edit, @proposal %>
    <%= link_to edit_proposal_path(@proposal), title: "edit idea", class: "btn btn-sm btn-primary", data: {toggle: "tooltip"} do %>
      <i class="fa fa-pencil-square-o"></i>
    <% end %>
  <% end %>

  <% if can? :delete, @proposal %>
    <%= link_to proposal_path(@proposal), method: :delete, title: "delete idea", class: "btn btn-sm btn-danger", data: { confirm: 'Are you sure?', toggle: 'tooltip' } do %>
      <i class="fa fa-trash"></i>
    <% end %>
  <% end %>

</span>
<br>
<br>

<div class="card">
  <div class="card-block">
    <h4 class="card-title">Description</h4>
    <%= @proposal.description.html_safe %>
  </div>
</div>

<div class="card">
  <div class="card-block">
    <h4 class="card-title">Essay</h4>
    <%= @proposal.essay.html_safe %>
  </div>
</div>

<% if @proposal.artist_cv.original_filename <=> '/artist_cvs/original/missing.png' %>
  <p>
    <strong>CV:</strong>
    <%= link_to @proposal.artist_cv.original_filename, asset_url(@proposal.artist_cv.url) %>
  </p>
<% end %>

<!-- <% if user_has_admin_access %>
  <p>
    <strong>Status:</strong>
    <%= @proposal.status %>
  </p>
<% end %> -->


<br>


<%# TODO avoid code duplication with this and proposal_comment views. %>
<% if can? :read, ProposalComment %>
  <h3>Comments</h3>
  <% @proposal.proposal_comments.each do |comment| %>

    <div class="card">
      <div class="card-block">
        <h6 class="card-title">
          <%= comment.user.fullname %>
          <span class="pull-right">
            <% if can? :edit, comment %>
              <%= link_to edit_proposal_proposal_comment_path(@proposal, comment), class: "btn btn-sm btn-primary" do %>
                <i class="fa fa-pencil-square-o"></i>
              <% end %>
            <% end %>
            <% if can? :destroy, comment %>
              <%= link_to proposal_proposal_comment_path(@proposal, comment), class: "btn btn-sm btn-danger", method: :delete, data: { confirm: 'Are you sure?' } do %>
                <i class="fa fa-times"></i>
              <% end %>
            <% end %>
          </span>
        </h6>
        <%= comment.body %>
      </div>
    </div>

    <!-- <p>
      <strong><%= comment.user.fullname %></strong>: <%= comment.body %>

    </p> -->

  <% end %>

  <% if can? :create, ProposalComment %>
    <br>
    <%= simple_form_for([@proposal, @proposal.proposal_comments.build]) do |f| %>
      <!-- <p> Add comment: </p> -->
      <%= f.input :body, label: "Add Comment" %>

      <div class='form-group'>
        <%= f.button :submit, value: 'Submit', class: 'btn-primary pull-right' %>
        <%# link_to ' Cancel', ideas_path %>
      </div>
      <% end %>
  <% end %>

<% end %>

<%= render partial: 'budget_modal' %>
