
<% if can? :create, :ideas %>
  <%= link_to 'create new idea', new_idea_path, class: 'btn btn-default pull-right top-40' %>
<% end %>

<h2 class="page-header">ideas</h2>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Sort Ideas<b class="caret"></b></a>
  <ul class="dropdown-menu">
    <!-- We are passing the sort parameter here -->
    <li><a href="?sort=likes">likes</a></li>
    <% if can? :read, :ideas, :first_name %>
      <li><a href="?sort=author_last_name">author last name</a></li>
    <% end %>
    <% if can? :read, :ideas, :last_name %>
      <li><a href="?sort=author_first_name">author first name</a></li>
    <% end %>
    <li><a href="?sort=date">date</a></li>
    <li><a href="?sort=id">id</a></li>
    <li><a href="?sort=category">category</a></li>
  </ul>
</li>
<div class="table-responsive">
  <table class="table table-striped">

    <thead>
      <tr>
        <% if not current_user.nil? and (current_user.admin? or current_user.moderator?) %>
          <th>ID</th>
        <% end %>

        <% if can? :read, :ideas, :first_name and can? :read, :ideas, :last_name %>
          <th>Author</th>
        <% end %>

        <% if can? :read, :ideas, :created_at %>
          <th>Created At</th>
        <% end %>

        <% if can? :read, :ideas, :category %>
          <th>Category</th>
        <% end %>

        <% if can? :read, :ideas, :description %>
          <th>Description</th>
        <% end %>

        <% if can? :read, :ideas, :status %>
          <th>Status</th>
        <% end %>

        <% if can? :read, :ideas, :likes %>
          <th>Likes</th>
        <% end %>

        <% if can? :like, :ideas or
          can? :show, :ideas or
          can? :edit, :ideas or
          can? :approve, :ideas or
          can? :destroy, :ideas %>
          <th colspan="5">Actions</th>
         <% end %>
      </tr>
    </thead>

    <% @ideas.each do |idea| %>
      <% if can? :read, idea %>
        <tr>
          <% if not current_user.nil? and (current_user.admin? or current_user.moderator?) %>
            <td><%= idea.id %></td>
          <% end %>

          <% if can? :read, idea, :first_name and can? :read, idea, :last_name %>
            <td><%= idea.author %></td>
          <% end %>

          <% if can? :read, idea, :created_at %>
            <td><%= idea.created_at.strftime("%B %d, %Y") %></td>
          <% end %>

          <% if can? :read, idea, :category %>
            <td><%= idea.category.name %></td>
          <% end %>

          <% if can? :read, idea, :description %>
            <td><%= truncate(idea.description) %></td>
          <% end %>

          <% if can? :read, idea, :status %>
            <td><%= idea.status %></td>
          <% end %>

          <% if can? :read, idea, :likes %>
            <td><%= idea.likes %></td>
          <% end %>

          <% if can? :like, idea %>
            <td>
              <% unless @likes.include?(idea.id) %>
                <a href=<%= idea_like_path(idea) %> ><i class="fa fa-thumbs-o-up"></i></a>
              <% else %>
                <a href=<%= idea_like_path(idea) %> ><i class="fa fa-thumbs-o-down"></i></a>
              <% end %>
            </td>
          <% end %>

          <% if can? :show, idea %>
            <td><%= link_to 'Show', idea_path(idea) %></td>
          <% end %>

          <% if can? :edit, idea %>
            <td><%= link_to 'Edit', edit_idea_path(idea) %></td>
          <% end %>

          <% if can? :approve, idea %>
            <td><%= link_to 'Approve', idea_approve_path(idea),
      	      method: :post,
      	      data: {confirm: 'Are you sure?' } %></td>
          <% end %>

          <% if can? :destroy, idea %>
            <td><%= link_to 'Destroy', idea_path(idea),
              method: :delete,
              data: { confirm: 'Are you sure?' } %></td>
          <% end %>
        </tr>
      <% end %>
    <% end %>

  </table>
</div>
